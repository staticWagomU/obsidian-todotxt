# Phase 4 デモシナリオ - Todo.txt for Obsidian

このドキュメントでは、Todo.txt for ObsidianプラグインのPhase 4で実装された全機能の操作手順と期待動作を説明します。

## Phase 4の概要

Phase 4では、以下の7つの主要機能が統合され、実用的なタスク管理環境が完成しました：

1. **優先度バッジ表示** (PBI-008) - 視覚的な優先度識別
2. **期日（due:）表示** (PBI-012) - 期限の確認と超過警告
3. **開始日（t:）グレーアウト** (PBI-013) - 着手時期の視覚化
4. **Obsidian内部リンク** (PBI-014) - 関連ノートへのリンク
5. **外部リンク表示** (PBI-015) - Webリソースへのアクセス
6. **繰り返しタスク（rec:）** (PBI-016) - 定期タスクの自動生成
7. **優先度タグ（pri:）保存** (PBI-017) - 完了時の優先度維持

加えて、以下の補助機能も含まれます：

8. **設定画面** (PBI-018) - プラグインのカスタマイズ
9. **構造化フォーム入力** (PBI-019) - todo.txt構文を意識しないタスク作成

## デモシナリオの構成

このドキュメントは以下の3つのセクションで構成されています：

### 1. 実働シナリオ（次セクション）
新規タスク作成から完了・設定変更までの一連の操作フローを、実際の手順として記載します。
- 新規タスク作成（フォーム入力）
- 優先度設定
- 期日・開始日設定（due: / t:）
- 繰り返しタスク設定（rec:）
- タスク完了とpri:タグ保存
- 設定変更

### 2. 7機能統合説明（後半セクション）
Sprint 18で統合された7つの主要機能の連携動作を詳しく説明します。
各機能がどのように相互作用するかを理解できます。

### 3. 期待動作と検証
各操作の期待される結果と、動作確認方法を記載します。

---

## 実働シナリオ：タスク管理の一連の流れ

このセクションでは、Todo.txt for Obsidianプラグインを使った実際のタスク管理フローを説明します。

### シナリオ：「週次レポート作成」タスクの管理

#### ステップ1: 新規タスク作成（フォーム入力）

**操作手順:**
1. `.txt`または`.todotxt`ファイルを開く
2. 「新規タスク作成」ボタンをクリック
3. フォームに以下を入力：
   - **説明**: `週次レポート作成`
   - **優先度**: `A`（最高優先度）
   - **期日**: `2026-01-15`（カレンダーから選択）
   - **開始日**: `2026-01-13`（カレンダーから選択）
   - **プロジェクト**: `+work`
   - **コンテキスト**: `@office`
   - **繰り返し**: `rec:+1w`（毎週繰り返し）
4. 「作成」ボタンをクリック

**期待される結果:**
ファイルに以下の行が追加されます：
```
(A) 2026-01-09 週次レポート作成 due:2026-01-15 t:2026-01-13 rec:+1w +work @office
```

**機能連携:**
- **PBI-019（フォーム入力）**: 構文を意識せずにタスクを作成
- **PBI-008（優先度）**: `(A)`が自動的に付与される
- **PBI-012（due:）**: 期日が`due:2026-01-15`として記録
- **PBI-013（t:）**: 開始日が`t:2026-01-13`として記録
- **PBI-016（rec:）**: 繰り返し設定が`rec:+1w`として記録

---

#### ステップ2: 優先度バッジ表示の確認

**操作手順:**
1. todo.txtファイルを開いたまま、タスクリストを確認

**期待される結果:**
- タスクの左側に**赤色の「A」バッジ**が表示される
- 優先度が視覚的に識別できる

**機能連携:**
- **PBI-008（優先度バッジ）**: `(A)`を赤色バッジとして表示
- 優先度A=赤、B=オレンジ、C=黄色、それ以外=グレー

---

#### ステップ3: 開始日前のグレーアウト表示

**現在日: 2026-01-09（開始日: 2026-01-13より前）**

**操作手順:**
1. タスクリストを確認

**期待される結果:**
- タスクが**グレーアウト表示**される
- `t:2026-01-13`のため、現在は着手時期ではないことが視覚的に分かる

**機能連携:**
- **PBI-013（t:グレーアウト）**: 開始日前のタスクを抑制表示
- 「今やるべきタスク」に集中できる

---

#### ステップ4: 開始日到達後の表示

**現在日: 2026-01-13（開始日到達）**

**操作手順:**
1. 2026-01-13になると、タスクリストを確認

**期待される結果:**
- タスクのグレーアウトが**解除**され、通常表示になる
- 優先度バッジが赤色で表示される
- `due:2026-01-15`が強調表示される（期日が近い）

**機能連携:**
- **PBI-013（t:）**: 開始日到達でグレーアウト解除
- **PBI-012（due:）**: 期日が近づいたことを視覚的に通知

---

#### ステップ5: Obsidian内部リンク追加

**操作手順:**
1. タスクをクリックして編集モードに入る
2. 説明文を以下のように変更：
   ```
   (A) 2026-01-09 週次レポート作成 [[週次レポートテンプレート]] due:2026-01-15 t:2026-01-13 rec:+1w +work @office
   ```
3. 保存

**期待される結果:**
- `[[週次レポートテンプレート]]`が**クリック可能なリンク**として表示される
- リンクをクリックすると、Obsidian内の対応ノートが開く

**機能連携:**
- **PBI-014（内部リンク）**: `[[...]]`記法を検出してリンク化
- タスクから関連資料へ素早くアクセス可能

---

#### ステップ6: 外部リンク追加

**操作手順:**
1. タスクを再度編集し、説明文に外部URLを追加：
   ```
   (A) 2026-01-09 週次レポート作成 [[週次レポートテンプレート]] https://example.com/report-guidelines due:2026-01-15 t:2026-01-13 rec:+1w +work @office
   ```
2. 保存

**期待される結果:**
- `https://example.com/report-guidelines`が**クリック可能なリンク**として表示される
- リンクをクリックすると、ブラウザで対応ページが開く

**機能連携:**
- **PBI-015（外部リンク）**: `http://`や`https://`を検出してリンク化
- タスクから外部リソースへ直接アクセス可能

---

#### ステップ7: タスク完了と繰り返しタスク自動生成

**操作手順:**
1. 2026-01-15にタスクが完了したと仮定
2. タスクの横にある**チェックボックスをクリック**して完了マークを付ける

**期待される結果:**

**完了したタスク:**
```
x 2026-01-15 2026-01-09 週次レポート作成 [[週次レポートテンプレート]] https://example.com/report-guidelines due:2026-01-15 t:2026-01-13 rec:+1w +work @office pri:1
```

**新規作成されたタスク:**
```
(A) 2026-01-15 週次レポート作成 [[週次レポートテンプレート]] https://example.com/report-guidelines due:2026-01-22 t:2026-01-20 rec:+1w +work @office
```

**機能連携:**
- **PBI-016（rec:繰り返し）**: `rec:+1w`により、完了日（2026-01-15）から1週間後（2026-01-22）を新しい期日として自動計算
- **PBI-017（pri:保存）**: 完了時に`(A)`が`pri:1`として保存され、優先度情報が維持される
- **PBI-013（t:自動計算）**: `t:2026-01-13`から`t:2026-01-20`（1週間後）に自動更新

---

#### ステップ8: 設定変更

**操作手順:**
1. Obsidianの設定を開く（`Settings` → `Community plugins` → `Todo.txt for Obsidian`）
2. 以下の設定を変更：
   - **Show Completed Tasks**: オフに変更
   - **Compact Mode**: オンに変更
   - **Auto Sort**: `Priority`を選択

**期待される結果:**
- **Show Completed Tasks OFF**: 完了済みタスク（`x`マーク付き）が非表示になる
- **Compact Mode ON**: タスクリストの行間が詰まり、より多くのタスクが一画面に表示される
- **Auto Sort Priority**: タスクが優先度順（A→B→C→なし→完了済み）に自動ソートされる

**機能連携:**
- **PBI-018（設定画面）**: プラグインの動作をユーザーの好みに合わせてカスタマイズ
- 設定は即座に反映され、再起動不要

---

## 7機能統合説明：Sprint 18で実現した連携動作

Sprint 18では、以下の7つの主要機能が1つのUIに統合され、シームレスに連携するタスク管理環境が実現しました。

### 1. PBI-008: 優先度バッジ表示

**機能概要:**
`(A)`～`(Z)`の優先度を色分けされたバッジとして表示します。

**表示ルール:**
- **(A)**: 赤色バッジ - 最高優先度
- **(B)**: オレンジ色バッジ - 高優先度
- **(C)**: 黄色バッジ - 中優先度
- **(D)以降**: グレー色バッジ - 低優先度

**他機能との連携:**
- **PBI-017（pri:保存）**: 完了時に`pri:N`として優先度を数値で保存し、次回の繰り返しタスクでも優先度が維持される
- **PBI-019（フォーム入力）**: フォームで優先度を選択すると、自動的に`(A)`～`(Z)`記法に変換される

**実例:**
```
(A) 緊急対応 due:2026-01-09 +support     → 赤色バッジ
(B) レビュー due:2026-01-10 +development → オレンジ色バッジ
(C) 調査 due:2026-01-15 +research        → 黄色バッジ
```

---

### 2. PBI-012: 期日（due:）表示

**機能概要:**
`due:YYYY-MM-DD`タグで指定された期日を視覚的に表示し、期日超過や接近を警告します。

**表示ルール:**
- **期日超過**（過去の日付）: 赤文字でハイライト
- **今日が期日**: 強調表示（太字）
- **明日が期日**: 注意表示（オレンジ色）
- **それ以外**: 通常表示

**他機能との連携:**
- **PBI-013（t:グレーアウト）**: `t:2026-01-15 due:2026-01-20`のように併用すると、開始日前はグレーアウトされ、開始日到達後に期日が強調表示される
- **PBI-016（rec:繰り返し）**: 繰り返しタスク完了時に、`rec:+1w`などの設定に基づいて次回の期日が自動計算される

**実例:**
```
(A) 納品 due:2026-01-05 +project          → 期日超過（赤文字）
(B) 打ち合わせ due:2026-01-09 @office     → 今日が期日（太字）
(C) 提出 due:2026-01-10 +homework         → 明日が期日（オレンジ）
```

---

### 3. PBI-013: 開始日（t:）によるグレーアウト

**機能概要:**
`t:YYYY-MM-DD`タグで指定された開始日より前のタスクをグレーアウト表示し、「今やるべきタスク」に集中できるようにします。

**表示ルール:**
- **開始日前**: グレーアウト表示（低コントラスト）
- **開始日到達**: 通常表示に自動切り替え

**他機能との連携:**
- **PBI-012（due:表示）**: `t:2026-02-01 due:2026-02-28`のように併用し、長期タスクを適切なタイミングで表示
- **PBI-016（rec:繰り返し）**: 繰り返しタスク完了時に、次回の開始日も自動計算される（`rec:+1w`なら1週間後）

**実例:**
```
t:2026-02-01 確定申告準備 due:2026-03-15 +taxes  → 2026-01-09時点ではグレーアウト
(A) 今日のタスク due:2026-01-09 @work           → 通常表示
```

---

### 4. PBI-014: Obsidian内部リンク

**機能概要:**
`[[ノート名]]`または`[[ノート名|表示テキスト]]`記法でObsidian内のノートにリンクできます。

**表示:**
- リンクは**青色のクリック可能なテキスト**として表示される
- クリックすると、Obsidian内の対応ノートが開く

**他機能との連携:**
- **PBI-015（外部リンク）**: 内部リンクと外部リンクを同じタスクに混在できる
- **PBI-019（フォーム入力）**: フォームの説明欄に`[[...]]`を入力すると、自動的にリンクとして認識される

**実例:**
```
(A) [[プロジェクトX]]の進捗確認 due:2026-01-10 +project-x
(B) [[デザインモックアップ|モックアップ]]レビュー @office
(C) 議事録作成 [[2026-01-09 定例会議]] +team
```

---

### 5. PBI-015: 外部リンク表示

**機能概要:**
`http://`または`https://`で始まるURLを自動検出し、クリック可能なリンクとして表示します。

**表示:**
- URLは**青色のクリック可能なテキスト**として表示される
- クリックすると、デフォルトブラウザで対応ページが開く

**他機能との連携:**
- **PBI-014（内部リンク）**: 内部リンクと外部リンクを同じタスクに混在できる
- **PBI-019（フォーム入力）**: フォームの説明欄にURLを入力すると、自動的にリンクとして認識される

**実例:**
```
(A) Obsidianプラグインドキュメント確認 https://docs.obsidian.md/Plugins +learning
(B) GitHub issue対応 https://github.com/user/repo/issues/123 +development
(C) 参考記事レビュー https://example.com/article +research
```

---

### 6. PBI-016: 繰り返しタスク（rec:）

**機能概要:**
`rec:+Nd`/`rec:Nw`/`rec:Nm`などのタグで繰り返しタスクを設定すると、タスク完了時に次回のタスクが自動生成されます。

**記法:**
- **厳格な繰り返し**（`rec:+`）: 完了日から次回期日を計算
  - `rec:+1d` → 完了日の1日後
  - `rec:+1w` → 完了日の1週間後
  - `rec:+1m` → 完了日の1ヶ月後
- **ゆるやかな繰り返し**（`rec:`）: 元の期日から次回期日を計算
  - `rec:1d` → 元の期日の1日後
  - `rec:1w` → 元の期日の1週間後

**他機能との連携:**
- **PBI-012（due:）**: `due:2026-01-09 rec:+1w`のように併用し、完了時に次回期日を自動計算
- **PBI-013（t:）**: `t:2026-01-13 rec:+1w`のように併用し、次回の開始日も自動計算
- **PBI-017（pri:保存）**: 完了時に優先度を`pri:N`として保存し、次回タスクでも優先度が維持される

**実例:**

**元のタスク:**
```
(A) 週報作成 due:2026-01-09 rec:+1w +work
```

**完了後（2026-01-10に完了）:**
```
x 2026-01-10 2026-01-09 週報作成 due:2026-01-09 rec:+1w +work pri:1
(A) 2026-01-10 週報作成 due:2026-01-17 rec:+1w +work
```

---

### 7. PBI-017: 優先度タグ（pri:）保存

**機能概要:**
タスク完了時に、`(A)`～`(Z)`の優先度を`pri:1`～`pri:26`の数値タグとして保存します。繰り返しタスクの場合、次回タスクでも同じ優先度が維持されます。

**変換ルール:**
- `(A)` → `pri:1`
- `(B)` → `pri:2`
- `(C)` → `pri:3`
- 以降、`(Z)` → `pri:26`

**他機能との連携:**
- **PBI-008（優先度バッジ）**: `pri:1`は`(A)`と同等に扱われ、赤色バッジで表示される
- **PBI-016（rec:繰り返し）**: 繰り返しタスク完了時に`pri:N`タグが引き継がれ、次回タスクも同じ優先度で作成される

**実例:**

**完了前:**
```
(A) 日報作成 due:2026-01-09 rec:+1d +work
```

**完了後:**
```
x 2026-01-09 2026-01-09 日報作成 due:2026-01-09 rec:+1d +work pri:1
(A) 2026-01-09 日報作成 due:2026-01-10 rec:+1d +work
```

**ポイント:**
- 完了タスクに`pri:1`が追加され、優先度情報が保存される
- 新規タスクは`(A)`優先度で作成され、次回完了時も同様に`pri:1`が保存される

---

## 機能連携の総括

上記7つの機能は、以下のように相互に連携し、強力なタスク管理環境を構築しています：

### 連携パターン1: 視覚化機能の組み合わせ
- **PBI-008（優先度バッジ）** + **PBI-012（due:表示）** + **PBI-013（t:グレーアウト）**
- 優先度・期日・開始日を視覚的に識別し、「今やるべきタスク」を明確に表示

### 連携パターン2: リンク機能の組み合わせ
- **PBI-014（内部リンク）** + **PBI-015（外部リンク）**
- タスクから関連ノート・外部リソースへシームレスにアクセス

### 連携パターン3: 繰り返しタスクの完全サポート
- **PBI-016（rec:繰り返し）** + **PBI-017（pri:保存）** + **PBI-012（due:）** + **PBI-013（t:）**
- 完了時に次回期日・開始日・優先度を自動計算し、定期タスクを効率的に管理

### 連携パターン4: 入力と表示の統合
- **PBI-019（フォーム入力）** + 全表示機能（PBI-008/012/013/014/015）
- フォームで入力したタスクが、即座にバッジ・期日・リンクなど全機能で適切に表示される

---

## 期待動作と検証

### 検証項目1: 新規タスク作成とバッジ表示

**操作:** フォームで`(A) テスト due:2026-01-09 +project`を作成  
**期待:** 赤色バッジ + 期日強調表示  
**検証:** タスクリストを目視確認

### 検証項目2: 開始日前のグレーアウト

**操作:** `t:2026-02-01`のタスクを2026-01-09に確認  
**期待:** タスクがグレーアウト表示  
**検証:** タスクリストを目視確認

### 検証項目3: 内部・外部リンクのクリック

**操作:** `[[ノート]] https://example.com`を含むタスクでリンクをクリック  
**期待:** 内部リンクはObsidianノート、外部リンクはブラウザでページが開く  
**検証:** リンクをクリックして動作確認

### 検証項目4: 繰り返しタスクの自動生成

**操作:** `rec:+1w due:2026-01-09`のタスクを2026-01-10に完了  
**期待:** `due:2026-01-17`の新規タスクが自動生成  
**検証:** ファイル内容を確認

### 検証項目5: 優先度の保存と引き継ぎ

**操作:** `(A)`の繰り返しタスクを完了  
**期待:** 完了タスクに`pri:1`、新規タスクに`(A)`が付与  
**検証:** ファイル内容を確認

### 検証項目6: 設定変更の反映

**操作:** `Show Completed Tasks`をオフに変更  
**期待:** 完了済みタスク（`x`マーク）が非表示  
**検証:** タスクリストを目視確認

---

## まとめ

Phase 4のデモシナリオでは、Todo.txt for Obsidianの主要機能を実際のタスク管理フローに沿って説明しました。

**重要なポイント:**
1. **視覚化**: 優先度バッジ・期日表示・グレーアウトにより、タスクの状態を一目で把握できる
2. **リンク**: Obsidian内部リンク・外部リンクにより、タスクから関連情報へ素早くアクセスできる
3. **自動化**: 繰り返しタスク・優先度保存により、定期タスクの管理が効率化される
4. **カスタマイズ**: 設定画面により、プラグインを自分の好みに合わせて調整できる
5. **統合**: フォーム入力により、todo.txt構文を意識せずに全機能を活用できる

これらの機能を組み合わせることで、プレーンテキストベースでありながら、リッチなタスク管理体験を実現できます。
